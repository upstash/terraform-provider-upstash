name: 'Automated Tests'

on:
  push:
    branches:
      - master
      - enchancement/kafka_cluster
  pull_request: 

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: PWD
        run: pwd
      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.16
      - name: Build provider
        run: go build .
      - name: Set config files
        run: export TF_CLI_CONFIG_FILE="/home/runner/work/terraform-provider-upstash/terraform-provider-upstash/terraformForGit.rc"
      - name: Test
        working-directory: integrationtesting
        env:
          UPSTASH_EMAIL: "bylmaz744@gmail.com"
          UPSTASH_API_KEY: "4a4634fa-71dc-4249-b029-144b82957571"
          TF_CLI_CONFIG_FILE: "/home/runner/work/terraform-provider-upstash/terraform-provider-upstash/terraformForGit.rc"
        run: go test *