name: 'Automated Tests'

on:
  push:
    branches:
      - master
      - enchancement/kafka_cluster
  pull_request: 

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: PWD
        run: pwd
      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.16
      - name: Build provider
        run: go build .
      - name: Test
        working-directory: integrationtesting
        env:
          UPSTASH_EMAIL: "bylmaz744@gmail.com"
          UPSTASH_API_KEY: "4a4634fa-71dc-4249-b029-144b82957571"
          TF_CLI_CONFIG_FILE: "/home/runner/work/terraform-provider-upstash/terraform-provider-upstash/terraformForGit.rc"
          UPSTASH_REDIS_DATABASE_NAME: "TestingRedisDatabase"
          UPSTASH_REDIS_DATABASE_REGION: "eu-west-1"
          UPSTASH_REDIS_DATABASE_TLS: "true"
          UPSTASH_REDIS_DATABASE_MULTIZONE: "false"
          UPSTASH_KAFKA_CLUSTER_NAME: "TestingKafkaCluster"
          UPSTASH_KAFKA_CLUSTER_REGION: "eu-west-1"
          UPSTASH_KAFKA_CLUSTER_MULTIZONE: "true"
          UPSTASH_KAFKA_TOPIC_NAME: "TestingKafkaTopic"
          UPSTASH_KAFKA_TOPIC_PARTITIONS: "1"
          UPSTASH_KAFKA_TOPIC_RETENTION_TIME: "625135"
          UPSTASH_KAFKA_TOPIC_RETENTION_SIZE: "725124"
          UPSTASH_KAFKA_TOPIC_MAX_MESSAGE_SIZE: "829213"
          UPSTASH_KAFKA_TOPIC_CLEANUP_POLICY: "delete"
          UPSTASH_TEAM_NAME: "TestingTeam"
          UPSTASH_TEAM_COPY_CC: "false"
          UPSTASH_TEAM_OWNER: "bylmaz744@gmail.com"
          UPSTASH_TEAM_DEVS: "dev1@a.com dev2@b.com"
          UPSTASH_TEAM_FINANCES: "finance1@c.com finance2@d.com"
        run: go test -v *